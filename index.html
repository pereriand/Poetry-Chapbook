<!DOCTYPE html>
<html>
<head>
    <title>Interactive Poetry Chapbook</title>
    <meta charset="UTF-8">
    <style>
        /* Global styles */
        body {
            font-family: 'Georgia', serif;
            margin: 0;
            padding: 0;
            background-color: #f9f6f2;
            color: #2c2c2c;
        }

        .page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        .content-container {
            max-width: 600px;
            width: 100%;
        }

        /* Navigation */
        .nav-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-style: italic;
            color: #666;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        /* Title page */
        .title-page {
            text-align: center;
        }

        .title-page h1 {
            font-size: 2.5em;
            margin-bottom: 0.5em;
        }

        /* Poem-specific styles */
        .line {
            padding: 3px 0;
            margin: 1px 0;
            transition: all 0.3s ease;
            font-size: 1em;
            font-weight: normal;
            position: relative;
            display: flex;
            align-items: center;
        }

        .stanza-break {
            height: 15px;
        }

        .current {
            font-weight: bold;
        }

        .current::before {
            content: "â˜ž";
            position: absolute;
            left: -35px;
            color: #666;
            font-weight: normal;
            font-size: 1.75em;
            line-height: 0;
            transform: translateY(-1px);
        }

        .future {
            color: #888888;
        }

        .instructions {
            margin-top: 35px;
            color: #666;
            font-style: italic;
            font-size: 0.9em;
        }

        /* Burning poem specific styles */
        .burning-poem-container {
            max-width: 36rem;
            margin: 0 auto;
            padding: 2rem;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .poem-content {
            display: flex;
            gap: 1.5rem;
        }

        .lighter {
            height: 8rem;
            width: 3rem;
            border-radius: 0.125rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem;
            background: linear-gradient(to bottom, #e5e7eb, #d1d5db);
            border: 1px solid #9ca3af;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .lighter:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .lighter-top {
            width: 2rem;
            height: 0.75rem;
            background-color: #52525b;
            border-radius: 0.125rem;
        }

        .flame {
            width: 1.5rem;
            height: 1.5rem;
            color: #f97316;
        }

        .flame.lit {
            animation: pulse 2s infinite;
        }

        .lighter-bottom {
            width: 2.5rem;
            height: 3rem;
            background: linear-gradient(to bottom, #71717a, #52525b);
            border: 1px solid #3f3f46;
            border-radius: 0.125rem;
        }

        .poem-lines {
            flex: 1;
            font-family: Georgia, serif;
            font-size: 1.125rem;
            line-height: 1.5;
        }

        .poem-line {
            position: relative;
            margin: 0.5rem 0;
        }

        .top-text, .hidden-text {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        .letter {
            display: inline-block;
            transition: all 300ms;
        }

        .letter.burning {
            color: #f97316;
            text-shadow: 0 0 4px #f97316, 0 0 8px #f97316, 0 0 12px #f97316;
            filter: blur(0.5px);
        }

        .letter.burnt {
            opacity: 0;
        }

        .hidden-letter {
            display: inline-block;
            color: #ef4444;
            text-shadow: 0 0 2px #b91c1c, 0 0 4px #991b1b;
            opacity: 0;
            transition: opacity 300ms ease-in;
            font-weight: 500;
        }

        .hidden-letter.revealed {
            opacity: 1;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Title Page -->
    <div class="page title-page">
        <div class="content-container">
            <h1>Interactive Poetry Chapbook</h1>
            <p>Scroll to explore two interactive poems</p>
        </div>
    </div>

    <!-- Tense Poem -->
    <div class="page">
        <div class="content-container">
            <h1>Weirdly Tense...</h1>
            <div id="poem"></div>
            <div class="instructions">Use arrow keys to navigate</div>
        </div>
    </div>

    <!-- Burning Poem -->
    <div class="page">
        <div class="content-container">
            <h1>The Burning Page</h1>
            <div id="burning-poem"></div>
        </div>
    </div>

    <div class="nav-hint">Scroll to move between poems</div>

    <script>
        // Tense poem logic
        const poem = [
            {
                past: "I drove to the store",
                present: "I drive to the store",
                future: "I will drive to the store"
            },
            {
                past: "Bought one of those whipped cream cans",
                present: "Buy one of those whipped cream cans",
                future: "Will buy one of those whipped cream cans"
            },
            {
                past: "Because I loved it",
                present: "Because I love it",
                future: "Because I will love it"
            },
            null,
            {
                past: "I loved it so much",
                present: "I love it so much",
                future: "I will love it so much"
            },
            {
                past: "That I forgot my car there",
                present: "That I forget my car there",
                future: "That I will forget my car there"
            },
            {
                past: "The store had to call",
                present: "The store has to call",
                future: "The store will have to call"
            },
            null,
            {
                past: "It whipped so perfect",
                present: "It whips so perfect",
                future: "It will whip so perfect"
            },
            {
                past: "So I took it to the films",
                present: "So I take it to the films",
                future: "So I will take it to the films"
            },
            {
                past: "Hid under my shirt",
                present: "Hide under my shirt",
                future: "Will hide under my shirt"
            },
            null,
            {
                past: "And on the next day",
                present: "And on this day",
                future: "And on the next day"
            },
            {
                past: "I returned to buy two more",
                present: "I return to buy two more",
                future: "I will return to buy two more"
            },
            {
                past: "But they were sold out",
                present: "But they are sold out",
                future: "But they will be sold out"
            }
        ];

        let currentLine = 0;

        function updateDisplay() {
            const poemDiv = document.getElementById('poem');
            poemDiv.innerHTML = '';
            
            poem.forEach((line, index) => {
                if (line === null) {
                    const breakDiv = document.createElement('div');
                    breakDiv.className = 'stanza-break';
                    poemDiv.appendChild(breakDiv);
                    return;
                }

                const div = document.createElement('div');
                div.className = 'line';
                
                let tense;
                const realIndex = poem.slice(0, index).filter(l => l !== null).length;
                if (realIndex < currentLine) tense = 'past';
                else if (realIndex === currentLine) tense = 'present';
                else tense = 'future';
                
                div.textContent = line[tense];
                if (realIndex === currentLine) {
                    div.classList.add('current');
                } else if (realIndex > currentLine) {
                    div.classList.add('future');
                }
                
                poemDiv.appendChild(div);
            });
        }

        function moveLine(direction) {
            const realLines = poem.filter(line => line !== null);
            const newLine = currentLine + direction;
            if (newLine >= 0 && newLine < realLines.length) {
                currentLine = newLine;
                updateDisplay();
            }
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowUp') {
                moveLine(-1);
                event.preventDefault();
            } else if (event.key === 'ArrowDown') {
                moveLine(1);
                event.preventDefault();
            }
        });

        // Burning poem logic
        class BurningPoem {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.isLit = false;
                this.burningCells = new Set();
                this.burntCells = new Set();
                this.isJumpingLine = false;
                this.complete = false;
                
                this.topPoem = [
                    "Words ignite like wandering flames,",
                    "dancing back across empty space,",
                    "each letter yields to amber light,",
                    "returning right then left again,",
                    "until all thoughts are ash and air,",
                    "and only memory remains."
                ];

                this.hiddenPoem = [
                    "Beneath the ash, new words emerge,",
                    "phoenix-like from burning page,",
                    "secrets written long ago,",
                    "awakening from their cage,",
                    "what once was lost returns anew,",
                    "rebirth upon this stage."
                ];

                this.initialize();
            }

            initialize() {
                this.container.innerHTML = `
                    <div class="burning-poem-container">
                        <div class="poem-content">
                            <button class="lighter" id="lighter">
                                <div class="lighter-top"></div>
                                <svg class="flame" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2c.5 2 2 3.5 2 5a3 3 0 0 1-6 0c0-1.5 1.5-3 2-5zm0 5c-.5 2-2 3.5-2 5a3 3 0 0 0 6 0c0-1.5-1.5-3-2-5z"/>
                                </svg>
                                <div class="lighter-bottom"></div>
                            </button>
                            <div class="poem-lines" id="poem-lines"></div>
                        </div>
                    </div>
                `;

                this.renderPoem();
                this.setupEventListeners();
            }

            getCellKey(lineIndex, charIndex) {
                return `${lineIndex}-${charIndex}`;
            }

            renderPoem() {
                const poemLines = this.container.querySelector('#poem-lines');
                poemLines.innerHTML = '';

                this.topPoem.forEach((line, lineIndex) => {
                    const lineDiv = document.createElement('div');
                    lineDiv.className = 'poem-line';
                    
                    // Top text
                    const topTextDiv = document.createElement('div');
                    topTextDiv.className = 'top-text';
                    line.split('').forEach((char, charIndex) => {
                        const span = document.createElement('span');
                        span.className = 'letter';
                        span.textContent = char;
                        span.dataset.key = this.getCellKey(lineIndex, charIndex);
                        topTextDiv.appendChild(span);
                    });

                    // Hidden text
                    const hiddenTextDiv = document.createElement('div');
                    hiddenTextDiv.className = 'hidden-text';
                    this.hiddenPoem[lineIndex].split('').forEach((char, charIndex) => {
                        const span = document.createElement('span');
                        span.className = 'hidden-letter';
                        span.textContent = char;
                        span.dataset.key = this.getCellKey(lineIndex, charIndex);
                        hiddenTextDiv.appendChild(span);
                    });

                    lineDiv.appendChild(topTextDiv);
                    lineDiv.appendChild(hiddenTextDiv);
                    poemLines.appendChild(lineDiv);
                });
            }

            setupEventListeners() {
                const lighter = this.container.querySelector('#lighter');
                lighter.addEventListener('click', () => {
                    if (!this.isLit) {
                        this.isLit = true;
                        lighter.disabled = true;
                        lighter.querySelector('.flame').classList.add('lit');
                        this.startBurning();
                    }
                });
            }

            startBurning() {
                this.burningCells.add(this.getCellKey(0, 0));
                this.updateDisplay();
                this.burnInterval = setInterval(() => this.updateBurning(), 50);
            }

            updateBurning() {
                if (this.isJumpingLine) {
                    this.isJumpingLine = false;
                    return;
                }

                const next = new Set();
                let allProcessed = true;

                for (const key of this.burningCells) {
                    const [lineIndex, charIndex] = key.split('-').map(Number);
                    
                    if (![...next].some(k => {
                        const [l, c] = k.split('-').map(Number);
                        return l === lineIndex && c === charIndex - 1;
                    })) {
                        this.burntCells.add(key);
                        this.burningCells.delete(key);
                    }
                    
                    if (charIndex + 1 < this.topPoem[lineIndex].length) {
                        const nextKey = this.getCellKey(lineIndex, charIndex + 1);
                        if (!this.burntCells.has(nextKey) && !this.burningCells.has(nextKey)) {
                            next.add(nextKey);
                            allProcessed = false;
                        }
                    }

                    if (lineIndex + 1 < this.topPoem.length) {
                        const downKey = this.getCellKey(lineIndex + 1, charIndex);
                        if (!this.burntCells.has(downKey) && !this.burningCells.has(downKey)) {
                            next.add(downKey);
                            allProcessed = false;
                            this.isJumpingLine = true;
                        }
                    }
                }

                if (allProcessed && next.size === 0) {
                    clearInterval(this.burnInterval);
                    this.complete = true;
                }

                this.burningCells = next;
                this.updateDisplay();
            }

            updateDisplay() {
                // Update burning letters
                this.container.querySelectorAll('.letter').forEach(letter => {
                    const key = letter.dataset.key;
                    letter.classList.remove('burning', 'burnt');
                    
                    if (this.burningCells.has(key)) {
                        letter.classList.add('burning');
                    } else if (this.burntCells.has(key)) {
                        letter.classList.add('burnt');
                    }
                });

                // Update hidden letters
                this.container.querySelectorAll('.hidden-letter').forEach(letter => {
                    const key = letter.dataset.key;
                    if (this.burntCells.has(key)) {
                        letter.classList.add('revealed');
                    }
                });
            }
        }

        // Initialize both poems when the document is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tense poem
            updateDisplay();
            
            // Initialize burning poem
            new BurningPoem('burning-poem');
        });
    </script>
</body>
</html>
